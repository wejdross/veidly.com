= API Overview
:description: Veidly REST API documentation and authentication guide
:keywords: api, rest, authentication, jwt

Veidly provides a RESTful API for managing events, users, and authentication. This guide covers API fundamentals, authentication, and common patterns.

== Base URL

The API base URL depends on your environment:

* **Development**: `http://localhost:8080/api`
* **Production**: `https://veidly.com/api`

All endpoints are prefixed with `/api` or `/api/public` for public endpoints.

== Authentication

Veidly uses JWT (JSON Web Token) based authentication.

=== Getting a Token

Authenticate using the login endpoint:

[source,bash]
----
curl -X POST http://localhost:8080/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "email": "user@example.com",
    "password": "password123"
  }'
----

Response:

[source,json]
----
{
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "user": {
    "id": 1,
    "email": "user@example.com",
    "name": "John Doe",
    "is_admin": false,
    "email_verified": true
  }
}
----

=== Using the Token

Include the token in the `Authorization` header for authenticated requests:

[source,bash]
----
curl -X GET http://localhost:8080/api/events \
  -H "Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
----

=== Token Expiration

JWT tokens expire after 24 hours. When a token expires:

* API returns `401 Unauthorized`
* Client should redirect to login page
* User must re-authenticate to get a new token

=== Optional Authentication

Some endpoints support optional authentication:

* If a token is provided, the API uses it to personalize the response
* If no token is provided, the API returns public information only

Examples:

* `GET /api/events` - Shows `is_participant` field if authenticated
* `GET /api/public/events/:slug` - Shows organizer contact if authenticated and joined

== Rate Limiting

The API implements rate limiting to prevent abuse:

[options="header"]
|===
|Endpoint Pattern |Rate Limit |Burst
|`/api/auth/*` |5 requests/minute |3
|`/api/*` (general) |10 requests/second |20
|===

When rate limited, the API returns:

[source,json]
----
{
  "error": "Rate limit exceeded"
}
----

HTTP Status: `429 Too Many Requests`

== Request Format

=== Content Type

All POST and PUT requests must use JSON:

[source,bash]
----
Content-Type: application/json
----

=== Date/Time Format

All timestamps use ISO 8601 format (RFC3339):

[source,json]
----
{
  "start_time": "2025-10-15T14:30:00Z",
  "end_time": "2025-10-15T16:30:00Z"
}
----

=== Coordinates

Latitude and longitude use decimal degrees:

[source,json]
----
{
  "latitude": 52.2297,
  "longitude": 21.0122
}
----

=== Arrays

Arrays are represented as JSON arrays:

[source,json]
----
{
  "custom_fields": [
    {"name": "Difficulty", "value": "Intermediate"},
    {"name": "Equipment", "value": "Bike, Helmet"}
  ]
}
----

== Response Format

=== Success Responses

Successful requests return JSON data with appropriate HTTP status:

* `200 OK` - Request succeeded, data in response body
* `201 Created` - Resource created, data in response body
* `204 No Content` - Request succeeded, no response body

Example:

[source,json]
----
{
  "id": 123,
  "title": "Bike Tour",
  "slug": "bike-tour-073db950",
  "latitude": 52.2297,
  "longitude": 21.0122,
  "start_time": "2025-10-15T14:30:00Z",
  "end_time": "2025-10-15T16:30:00Z",
  "max_participants": 20,
  "current_participants": 5,
  "is_participant": true
}
----

=== Error Responses

Errors return JSON with an `error` field and appropriate HTTP status:

* `400 Bad Request` - Invalid request data
* `401 Unauthorized` - Authentication required or invalid token
* `403 Forbidden` - Authenticated but not authorized
* `404 Not Found` - Resource not found
* `409 Conflict` - Duplicate resource (e.g., email already exists)
* `422 Unprocessable Entity` - Validation failed
* `429 Too Many Requests` - Rate limit exceeded
* `500 Internal Server Error` - Server error

Example error:

[source,json]
----
{
  "error": "Email already registered"
}
----

=== Privacy Filtering

Responses are filtered based on the viewer's permissions:

[options="header"]
|===
|Viewer Status |What They See
|Unauthenticated |Basic event info, organizer hidden if privacy enabled
|Authenticated but not verified |Basic event info, contact hidden
|Authenticated and verified |Full event info, contact hidden unless joined
|Participant |Full event info including organizer contact
|Creator or Admin |Full event info, all details visible
|===

Example - Same event, different viewers:

**Unauthenticated user:**
[source,json]
----
{
  "id": 123,
  "title": "Bike Tour",
  "creator_name": "ðŸ”’ Join to see organizer",
  "creator_contact": ""
}
----

**Authenticated but not joined:**
[source,json]
----
{
  "id": 123,
  "title": "Bike Tour",
  "creator_name": "John Doe",
  "creator_contact": "ðŸ”’ Join to see contact"
}
----

**Participant:**
[source,json]
----
{
  "id": 123,
  "title": "Bike Tour",
  "creator_name": "John Doe",
  "creator_contact": "john@example.com"
}
----

== Pagination

List endpoints support pagination via query parameters:

[source,bash]
----
GET /api/events?limit=20&offset=0
----

Parameters:

* `limit` - Number of results per page (default: 50, max: 100)
* `offset` - Number of results to skip (default: 0)

Response includes pagination metadata:

[source,json]
----
{
  "events": [...],
  "total": 150,
  "limit": 20,
  "offset": 0
}
----

== Filtering and Search

=== Geographic Filtering

Filter events by bounding box:

[source,bash]
----
GET /api/events?sw_lat=52.1&sw_lng=20.9&ne_lat=52.3&ne_lng=21.1
----

Parameters:

* `sw_lat`, `sw_lng` - Southwest corner (bottom-left)
* `ne_lat`, `ne_lng` - Northeast corner (top-right)

=== Search by Keywords

Search events by title or description:

[source,bash]
----
GET /api/events?search=bike
----

=== Filter by Date Range

Filter events by time range:

[source,bash]
----
GET /api/events?start_after=2025-10-15T00:00:00Z&start_before=2025-10-20T23:59:59Z
----

=== Filter by Language

Filter events by language code:

[source,bash]
----
GET /api/events?lang=pl
----

Supported languages: `en`, `pl`

== Validation

The API validates all input data:

=== Email Validation

* Must be valid email format
* Maximum 100 characters
* Checked for existing registration

=== Password Requirements

* Minimum 6 characters
* Maximum 100 characters

=== Event Validation

* `title`: Required, 1-200 characters
* `description`: Optional, max 2000 characters
* `latitude`: Required, -90 to 90
* `longitude`: Required, -180 to 180
* `start_time`: Required, ISO 8601 format, future date
* `end_time`: Required, must be after start_time
* `max_participants`: Optional, 1-10000
* `language`: Required, one of: en, pl

=== Custom Fields

* Maximum 10 custom fields per event
* Each field: `name` (max 100 chars), `value` (max 500 chars)

Validation errors return `422 Unprocessable Entity`:

[source,json]
----
{
  "error": "Validation failed",
  "details": {
    "email": "Invalid email format",
    "password": "Password must be at least 6 characters"
  }
}
----

== Common Patterns

=== Creating a Resource

[source,bash]
----
POST /api/events
Content-Type: application/json
Authorization: Bearer <token>

{
  "title": "Morning Yoga",
  "description": "Relaxing outdoor yoga session",
  "latitude": 52.2297,
  "longitude": 21.0122,
  "start_time": "2025-10-20T07:00:00Z",
  "end_time": "2025-10-20T08:00:00Z",
  "max_participants": 15,
  "language": "en"
}
----

Response: `201 Created` with full resource in body

=== Updating a Resource

[source,bash]
----
PUT /api/events/123
Content-Type: application/json
Authorization: Bearer <token>

{
  "title": "Morning Yoga (Updated)",
  "max_participants": 20
}
----

Response: `200 OK` with updated resource

=== Deleting a Resource

[source,bash]
----
DELETE /api/events/123
Authorization: Bearer <token>
----

Response: `204 No Content`

=== Joining an Event

[source,bash]
----
POST /api/events/123/join
Authorization: Bearer <token>
----

Response: `200 OK`

[source,json]
----
{
  "message": "Successfully joined event"
}
----

=== Leaving an Event

[source,bash]
----
POST /api/events/123/leave
Authorization: Bearer <token>
----

Response: `200 OK`

[source,json]
----
{
  "message": "Successfully left event"
}
----

== Client Libraries

=== JavaScript/TypeScript

Veidly frontend uses Axios with TypeScript types:

[source,typescript]
----
import axios from 'axios';

const api = axios.create({
  baseURL: import.meta.env.VITE_API_URL,
  headers: {
    'Content-Type': 'application/json',
  },
});

// Add auth token to requests
api.interceptors.request.use((config) => {
  const token = localStorage.getItem('token');
  if (token) {
    config.headers.Authorization = `Bearer ${token}`;
  }
  return config;
});

// Usage
const events = await api.get('/api/events');
----

=== cURL Examples

Throughout this documentation, we provide cURL examples. To make them easier to use, set environment variables:

[source,bash]
----
export API_URL="http://localhost:8080"
export TOKEN="your-jwt-token-here"

curl -X GET $API_URL/api/events \
  -H "Authorization: Bearer $TOKEN"
----

== Security Considerations

=== HTTPS

Always use HTTPS in production to protect:

* Authentication tokens
* User credentials
* Sensitive event data

=== Token Storage

* **Web**: Store in localStorage or sessionStorage
* **Mobile**: Use secure storage (Keychain/Keystore)
* **Never**: Store in cookies accessible to JavaScript (XSS risk)

=== CORS

The API implements CORS (Cross-Origin Resource Sharing):

* Allowed origins: Configurable via environment
* Credentials: Supported
* Methods: GET, POST, PUT, DELETE, OPTIONS
* Headers: Authorization, Content-Type

=== Input Sanitization

All user input is sanitized:

* SQL injection protection via parameterized queries
* XSS prevention via JSON encoding
* Path traversal prevention

=== Rate Limiting

Implement client-side rate limiting to avoid hitting server limits:

[source,typescript]
----
// Example: Simple rate limiter
class RateLimiter {
  private requests: number[] = [];

  async throttle(maxRequests: number, perSeconds: number) {
    const now = Date.now();
    this.requests = this.requests.filter(t => t > now - perSeconds * 1000);

    if (this.requests.length >= maxRequests) {
      const oldestRequest = this.requests[0];
      const waitTime = (oldestRequest + perSeconds * 1000) - now;
      await new Promise(resolve => setTimeout(resolve, waitTime));
    }

    this.requests.push(Date.now());
  }
}
----

== Webhooks (Future)

Webhooks are not currently implemented but planned for future releases:

* Event created/updated/deleted
* User joined/left event
* Email verification completed

== API Versioning

Currently, the API is unversioned (v1 implicit). Future versions will use URL-based versioning:

* Current: `/api/events`
* Future: `/api/v2/events`

Breaking changes will be announced with a deprecation period.

== Next Steps

Explore specific endpoint documentation:

* xref:api/authentication.adoc[Authentication Endpoints] - Register, login, verify email
* xref:api/events.adoc[Events Endpoints] - CRUD operations, search, join/leave
* xref:api/users.adoc[Users Endpoints] - Profile management, admin operations

== Additional Resources

* https://jwt.io/[JWT.io] - JWT debugger and documentation
* https://httpstatuses.com/[HTTP Status Codes] - Reference guide
* xref:development/testing.adoc[Testing Guide] - API testing examples
* xref:features/authentication.adoc[Authentication Feature] - Implementation details
